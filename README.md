# 构建基于服务端渲染的 React 博客应用

服务端渲染能够在很大程度上提高 SEO 的效果，这对博客来说是非常有必要的。本阶段，我们的目标是将原来的客户端渲染工程转变成服务端渲染，我们将使用 Next.js 完成本部分功能。

>注：本部分内容和之前几次实践项目的跨度较大，并且需要一定的 Node.js 的知识，这里建议大家先学习本课程提供的相关扩展文档，例如 `Koa 简介` 等文档，并且充分学习课程中的 Next.js 案例，之后可以参考我们本次的项目要求和示例代码，进行学习。


## 项目说明

本次项目需要的后端数据接口和上一次的相同，如果之前已经启动过 `my-react-blog-backend`，则按照之前的启动方式继续启动即可，这里再次重复一遍启动命令：

```
cd my-react-blog-backend

npm install

npm start
```

这次，我们的 React 博客实际上并不是一个前端项目，而是一个 Node 端项目，所以，我们的博客本身实际上可以提供数据请求响应服务，这里我们没有这样去做的原因是为了减少项目切换成本。

另外本次项目可能会因为系统环境不同造成无法正常安装使用的情况，这个时候希望大家能够积极在课程提供的网址上进行反馈。

## 目录结构

我们这次的目录结构也有了较大的变化，主要如下：

```
├── .babelrc babel配置文件
├── next.config.js next配置文件
├── server.js Node服务启动文件
├── static 静态资源文件
├── src
|	├── components 展示类组件
|	├── config 配置文件
|	├── container 容器布局类组件
|	└── style 样式文件
└── pages
	├── _document.js HTML模版页面
	├── Main 主界面资源文件
	├── Main.jsx 主界面入口文件
	├── Article 文章界面资源文件
	├── Article.jsx 文章界面入口文件
	├── ArchiveList 存档页面资源文件
	├── ArchiveList.jsx 存档页面入口文件
	├── Feedback 反馈页面资源文件
	└── Feedback.jsx 反馈页面入口文件
```

我们的目录部分部分受限于 next.js 的规则，新建了 pages 页面并且把服务端渲染所需的主要入口文件都放在其中，但同时为了避免对目录造成过多改动，我们还将大部分细化组件的内容放在了 src 文件夹下并且沿用之前的组织形式。

## 具体要求

本次项目的具体要求如下：

### 复习并掌握课程中提及的 Next.js Demo 案例

在课程中，我们通过一个搜索项目初步熟悉了 Next.js 服务端渲染开发，这对于我们上手博客项目是非常有必要的，我们需要先行对此项目进行熟悉，在这个知识基础上，我们才可较为顺利的完成博客项目的 Next.js 的环境搭建。

### 搭建并运行基于 Next.js 服务端渲染的博客项目

依照上面提供的目录结构，搭建 Next.js 服务端渲染的运行环境，并且成功运行 React 相关项目。

这部分注意点较多，主要几个容易出现错误的地方是：

* 我们的项目中无需添加 `webpack.config.js` 等相关 webpack 配置，也无需自行下载 webpack。
* 我们需要在 `next.config.js` 中配置 `next-less` 等相关插件，否则服务端渲染的内容可能会不正确。

>本部分内容基本都已经给出代码，但是希望大家能够自行理解。

### 服务端拉取数据

出于 SEO 的考虑，一般我们服务端渲染返回的字节流应当是有具体数据的，否则我们服务端渲染的效果会大打折扣。所以，我们需要在服务端拉取数据，这部分内容样例代码中并没有给出，但是借助于 Next.js 提供的 `getInitialProps` API，我们可以很方便地做到这一点，**我们的目标是对主要页面都做到服务端拉取数据，并且防止客户端二次请求造成浪费**。

这部分内容请大家自行完成。

>注：考虑系统原因，如果下载的样例代码中存在 node_modules，建议删除后重新下载，另外 Next.js 无需在项目中自行安装 webpack（全局安装无影响），如果安装可能会因版本问题导致冲突。 

## 总结

到这里，我们的全部项目就结束了，我们总共经历了从开始搭建 React 博客开发环境，到一步步对页面和功能进行完善，再到重构成 SPA 单页面应用，再到服务端渲染，对 React 开发博客进行了一个完整的实践，一般来说，到这个阶段大家已经拥有了使用 React 搭建用于生产环境的博客的能力，大家可以根据自己的学习情况，自行选择一种方式（多页面客户端渲染、单页面客户端渲染、服务端渲染）继续深入，并借助 Nginx、pm2 等工具，将最终的博客部署上线。
